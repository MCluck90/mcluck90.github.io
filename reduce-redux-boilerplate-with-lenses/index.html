<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-116914548-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-116914548-1');
    </script>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    <!-- Enable responsiveness on mobile devices-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

    <title>
Reduce Redux Boilerplate with Lenses - Stuff and Things
</title>

    <!-- CSS -->
    <link rel="stylesheet" href="https:&#x2F;&#x2F;mcluck.tech&#x2F;print.css" media="print">
    <link rel="stylesheet" href="https:&#x2F;&#x2F;mcluck.tech&#x2F;poole.css">
    <link rel="stylesheet" href="https:&#x2F;&#x2F;mcluck.tech&#x2F;hyde.css">
    <link rel="stylesheet" href="https:&#x2F;&#x2F;mcluck.tech&#x2F;custom.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

    
    <link rel="alternate" type="application/rss+xml" title="RSS" href="https:&#x2F;&#x2F;mcluck.tech&#x2F;rss.xml">
    

    

<meta name="keywords" content="react,redux,lens,lenses,functional programming,typescript">


  </head>

  <body class=" ">
    
      <div class="sidebar">
        <div class="container sidebar-sticky">
          <div class="sidebar-about">
            
              <a href="https:&#x2F;&#x2F;mcluck.tech"><h1>Stuff and Things</h1></a>
              
              <p class="lead">A descent into the mind of Mike Cluck</p>
              
            
          </div>

          <ul class="sidebar-nav">
            
            
            <li><a href="https:&#x2F;&#x2F;github.com&#x2F;MCluck90">GitHub</a></li>
            
            <li><a href="https:&#x2F;&#x2F;stackoverflow.com&#x2F;users&#x2F;371184&#x2F;mike-c">Stack Overflow</a></li>
            
            <li><a href="https:&#x2F;&#x2F;twitter.com&#x2F;MikeCluck">Twitter</a></li>
            
            
          </ul>
          <pre>
// Email
const username = "mcluck90";
const host = "google.com";
          </pre>
        </div>
      </div>
    

    <div class="content container">
      
<div class="post">
  <h1 class="post-title">Reduce Redux Boilerplate with Lenses</h1>
  <span class="post-date">2019-11-05</span>
  <p>I've been speaking with <a href="https://github.com/tmonte">my coworkers</a> a lot lately about all of the boilerplate necessary with a Redux-based app. Usually these conversations break down to &quot;we need yet another framework&quot; vs. &quot;frameworks got us here&quot;. Some people have made some very interesting projects as a way of reducing boilerplate for restricted use cases (see: <a href="https://github.com/dvajs/dva">dva</a>, <a href="https://kea.js.org/">Kea</a>). My coworker told me about something entirely different though: lenses.</p>
<p>Before this I had never heard of lenses so I am far from an expert. My understanding of lenses is they provide an abstraction over getters and setters in an immutable way. <a href="https://medium.com/javascript-scene/lenses-b85976cb0534">I recommend this article if you aren't familiar with lenses.</a>. Let me tell you why we think they can be used to significantly simplify a Redux application.</p>
<h2 id="immutable-reducers">Immutable Reducers</h2>
<p>When working with Redux, it's in our best interest to keep everything immutable. Having an immutable state is what allows for things like time-travel debugging and helps make the app more predictable. To keep everything immutable, we frequently end up writing reducers that look like this:</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#569cd6;">const </span><span style="color:#dcdcdc;">gameReducer = (state</span><span style="color:#569cd6;">: </span><span style="color:#4ec9b0;">State</span><span style="color:#dcdcdc;">, action</span><span style="color:#569cd6;">: </span><span style="color:#4ec9b0;">Action</span><span style="color:#dcdcdc;">) </span><span style="color:#569cd6;">=&gt; </span><span style="color:#dcdcdc;">{</span><span style="color:#dcdcdc;">
  </span><span style="color:#569cd6;">switch </span><span style="color:#dcdcdc;">(action.type) {</span><span style="color:#dcdcdc;">
    </span><span style="color:#569cd6;">case </span><span style="color:#d69d85;">&#39;UPDATE_PLAYER_SCORE&#39;</span><span style="color:#dcdcdc;">:</span><span style="color:#dcdcdc;">
      </span><span style="color:#569cd6;">return </span><span style="color:#dcdcdc;">{</span><span style="color:#dcdcdc;">
        </span><span style="color:#569cd6;">...</span><span style="color:#dcdcdc;">state,</span><span style="color:#dcdcdc;">
        playerScore: action.payload</span><span style="color:#dcdcdc;">
      }</span><span style="color:#dcdcdc;">
    </span><span style="color:#569cd6;">default</span><span style="color:#dcdcdc;">:</span><span style="color:#dcdcdc;">
      </span><span style="color:#569cd6;">return </span><span style="color:#dcdcdc;">state;</span><span style="color:#dcdcdc;">
  }</span><span style="color:#dcdcdc;">
}</span><span style="color:#dcdcdc;">
</span></pre>
<p>That little <code>{ ...state, playerScore: action.payload }</code> is essentially what a lens does when setting a value. The difference is that it works all the way down. Where as before you might write either a series of reducers:</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#569cd6;">const </span><span style="color:#dcdcdc;">stateReducer = combineReducers({</span><span style="color:#dcdcdc;">
  player: combineReducers({</span><span style="color:#dcdcdc;">
    position: playerPositionReducer,</span><span style="color:#dcdcdc;">
    score: playerScoreReducer</span><span style="color:#dcdcdc;">
  })</span><span style="color:#dcdcdc;">
})</span><span style="color:#dcdcdc;">
</span></pre>
<p>or a single reducer with a bunch of nested spread operations:</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#569cd6;">const </span><span style="color:#dcdcdc;">stateReducer = (state</span><span style="color:#569cd6;">: </span><span style="color:#4ec9b0;">State</span><span style="color:#dcdcdc;">, action</span><span style="color:#569cd6;">: </span><span style="color:#4ec9b0;">Action</span><span style="color:#dcdcdc;">) </span><span style="color:#569cd6;">=&gt; </span><span style="color:#dcdcdc;">{</span><span style="color:#dcdcdc;">
  </span><span style="color:#569cd6;">switch </span><span style="color:#dcdcdc;">(action.type) {</span><span style="color:#dcdcdc;">
    </span><span style="color:#569cd6;">case </span><span style="color:#d69d85;">&#39;UPDATE_PLAYER_SCORE&#39;</span><span style="color:#dcdcdc;">:</span><span style="color:#dcdcdc;">
      </span><span style="color:#569cd6;">return </span><span style="color:#dcdcdc;">{</span><span style="color:#dcdcdc;">
        </span><span style="color:#569cd6;">...</span><span style="color:#dcdcdc;">state,</span><span style="color:#dcdcdc;">
        player: {</span><span style="color:#dcdcdc;">
          </span><span style="color:#569cd6;">...</span><span style="color:#dcdcdc;">state.player,</span><span style="color:#dcdcdc;">
          score: action.payload</span><span style="color:#dcdcdc;">
        }</span><span style="color:#dcdcdc;">
      }</span><span style="color:#dcdcdc;">
    </span><span style="color:#569cd6;">default</span><span style="color:#dcdcdc;">:</span><span style="color:#dcdcdc;">
      </span><span style="color:#569cd6;">return </span><span style="color:#dcdcdc;">state;</span><span style="color:#dcdcdc;">
  }</span><span style="color:#dcdcdc;">
}</span><span style="color:#dcdcdc;">
</span></pre>
<p>you can perform that entire operation with a single lens:</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#569cd6;">const </span><span style="color:#dcdcdc;">stateReducer = (state: State</span><span style="color:#569cd6;">, </span><span style="color:#dcdcdc;">action: Action</span><span style="color:#ff3333;">) </span><span style="color:#569cd6;">=&gt; </span><span style="color:#dcdcdc;">{</span><span style="color:#dcdcdc;">
  </span><span style="color:#569cd6;">switch </span><span style="color:#dcdcdc;">(action.</span><span style="color:#b5cea8;">type</span><span style="color:#dcdcdc;">) {</span><span style="color:#dcdcdc;">
    </span><span style="color:#569cd6;">case </span><span style="color:#d69d85;">&#39;UPDATE_PLAYER_SCORE&#39;</span><span style="color:#dcdcdc;">:</span><span style="color:#dcdcdc;">
      </span><span style="color:#569cd6;">return </span><span style="color:#dcdcdc;">playerScoreLens.set(action.payload)</span><span style="color:#dcdcdc;">
    </span><span style="color:#569cd6;">default</span><span style="color:#dcdcdc;">:</span><span style="color:#dcdcdc;">
      </span><span style="color:#569cd6;">return </span><span style="color:#dcdcdc;">state;</span><span style="color:#dcdcdc;">
  }</span><span style="color:#dcdcdc;">
}</span><span style="color:#dcdcdc;">
</span></pre>
<p>and it's all still immutable! Now you might be thinking &quot;but now I have to write all of these lenses!&quot; You're right but it's easier than you might think.</p>
<h2 id="composability">Composability</h2>
<p>If you've ever used <a href="https://github.com/reduxjs/reselect"><code>reselect</code></a> before you'll know how nice it is to compose together selectors. You write one selector to get a section of the state tree then compose smaller selectors based off of that one. With lenses, you can get the same kind of composability.</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#569cd6;">const </span><span style="color:#dcdcdc;">playerLens = Lens.fromProp&lt;</span><span style="color:#4ec9b0;">State</span><span style="color:#dcdcdc;">&gt;()(</span><span style="color:#d69d85;">&#39;player&#39;</span><span style="color:#dcdcdc;">)</span><span style="color:#dcdcdc;">
</span><span style="color:#569cd6;">const </span><span style="color:#dcdcdc;">playerPositionLens = playerLens</span><span style="color:#dcdcdc;">
  .compose(Lens.fromProp&lt;</span><span style="color:#4ec9b0;">State</span><span style="color:#dcdcdc;">[</span><span style="color:#d69d85;">&#39;player&#39;</span><span style="color:#dcdcdc;">]&gt;()(</span><span style="color:#d69d85;">&#39;position&#39;</span><span style="color:#dcdcdc;">))</span><span style="color:#dcdcdc;">
</span><span style="color:#569cd6;">const </span><span style="color:#dcdcdc;">playerScoreLens = playerLens</span><span style="color:#dcdcdc;">
  .compose(Lens.fromProp&lt;</span><span style="color:#4ec9b0;">State</span><span style="color:#dcdcdc;">[</span><span style="color:#d69d85;">&#39;player&#39;</span><span style="color:#dcdcdc;">]&gt;()(</span><span style="color:#d69d85;">&#39;score&#39;</span><span style="color:#dcdcdc;">))</span><span style="color:#dcdcdc;">
</span></pre><h2 id="no-more-reducers">No More Reducers?</h2>
<p>Each of the lenses we write that are composed together from the root of the state produce a new state value whenever a setter is called. That means that every lens you write is a self-contained reducer. If each of these lenses is a reducer then how do we handle actions? Quite simply, by only having a single action.</p>
<p>With one action and one reducer you can hook up your entire Redux store. The One True Action will send out an entire state transformation.</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#608b4e;">// The One True Action</span><span style="color:#dcdcdc;">
</span><span style="color:#569cd6;">const </span><span style="color:#dcdcdc;">updateState = (state</span><span style="color:#569cd6;">: </span><span style="color:#4ec9b0;">State</span><span style="color:#dcdcdc;">) </span><span style="color:#569cd6;">=&gt; </span><span style="color:#dcdcdc;">({</span><span style="color:#dcdcdc;">
  type: </span><span style="color:#d69d85;">&#39;UPDATE_STATE&#39;</span><span style="color:#dcdcdc;">,</span><span style="color:#dcdcdc;">
  payload: state</span><span style="color:#dcdcdc;">
})</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">
</span><span style="color:#569cd6;">...</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">
</span><span style="color:#608b4e;">// The One True Reducer</span><span style="color:#dcdcdc;">
</span><span style="color:#569cd6;">const </span><span style="color:#dcdcdc;">stateReducer = (state</span><span style="color:#569cd6;">: </span><span style="color:#4ec9b0;">State</span><span style="color:#dcdcdc;">, action</span><span style="color:#569cd6;">: </span><span style="color:#4ec9b0;">Action</span><span style="color:#dcdcdc;">) </span><span style="color:#569cd6;">=&gt; </span><span style="color:#dcdcdc;">{</span><span style="color:#dcdcdc;">
  </span><span style="color:#569cd6;">switch </span><span style="color:#dcdcdc;">(action.type) {</span><span style="color:#dcdcdc;">
    </span><span style="color:#569cd6;">case </span><span style="color:#d69d85;">&#39;UPDATE_STATE&#39;</span><span style="color:#dcdcdc;">:</span><span style="color:#dcdcdc;">
      </span><span style="color:#569cd6;">return </span><span style="color:#dcdcdc;">action.payload;</span><span style="color:#dcdcdc;">
    </span><span style="color:#569cd6;">default</span><span style="color:#dcdcdc;">:</span><span style="color:#dcdcdc;">
      </span><span style="color:#569cd6;">return </span><span style="color:#dcdcdc;">state;</span><span style="color:#dcdcdc;">
  }</span><span style="color:#dcdcdc;">
}</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">
</span><span style="color:#569cd6;">...</span><span style="color:#dcdcdc;">
</span><span style="color:#dcdcdc;">
</span><span style="color:#608b4e;">// How to use them</span><span style="color:#dcdcdc;">
dispatch(updateState(playerScoreLens.set(</span><span style="color:#b5cea8;">10</span><span style="color:#dcdcdc;">)));</span><span style="color:#dcdcdc;">
</span></pre><h2 id="considerations">Considerations</h2>
<p>We haven't launched this in a production application but we may be experimenting with it now. Here's some of the questions I had as <a href="https://github.com/tmonte">@tmonte</a> was explaining this to me.</p>
<blockquote>
<p>What if you have cross-functional teams and another team isn't using this approach? How do they respond to your state changes?</p>
</blockquote>
<p>Doing this does not stop you from emitting events in the same way as you were before. It just means you need an extra function call when you want to share information.</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#dcdcdc;">dispatch(updateState(playerScoreLens.set(</span><span style="color:#b5cea8;">10</span><span style="color:#dcdcdc;">)));</span><span style="color:#dcdcdc;">
dispatch(updatePlayerScore(</span><span style="color:#b5cea8;">10</span><span style="color:#dcdcdc;">));</span><span style="color:#dcdcdc;">
</span></pre>
<blockquote>
<p>Are lenses memoized? Will this lead to performance problems?</p>
</blockquote>
<p><a href="https://github.com/gcanti/monocle-ts">monocle-ts</a> is not memoized so you would have to provide your own memoization on top of it. In other ways, performance may actually improve since you won't have to call a bunch of different reducers just in case they handle the action you emitted. This isn't a blanket statement though; you'll have to perform your own measurements with your situation.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Lenses seem like a really cool abstraction that could help a lot with deep state immutability. Really, this idea just fascinated me and I wanted to spew my thoughts on the matter. I'd love to get feedback from you! I'm actively trying to find all of the pros and cons of this approach and would love to hear from people with different experiences than me.</p>

</div>


<div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
var disqus_config = function () {
  this.page.url = 'https://mcluck.tech/reduce-redux-boilerplate-with-lenses/';  // Replace PAGE_URL with your page's canonical URL variable
  this.page.identifier = 'reduce-redux-boilerplate-with-lenses'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://mcluck.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


    </div>

    <script>
      // Toggle code snippets
      document.addEventListener('click', function(event) {
        var target = event.target;
        if (!target.classList.contains('toggle-codeblock')) {
          return;
        }

        var container = target.parentNode;
        if (container.classList.contains('visible')) {
          container.classList.remove('visible');
        } else {
          container.classList.add('visible');
        }
      });
    </script>

  </body>

</html>
